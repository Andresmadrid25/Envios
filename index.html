<?php include("config/conexion.php"); ?>

<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gesti√≥n de Env√≠os</title>

    <!-- Fuentes e √≠conos modernos -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">

    <style>
        :root{
            --glass-bg: rgba(255,255,255,0.6);
            --accent: #7c5cff;
        }
        html,body{height:100%;}
        body{
            font-family: 'Inter', system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
            background: linear-gradient(135deg, #0f172a 0%, #0b1220 40%, #071023 100%);
            color:#0b1220;
            -webkit-font-smoothing:antialiased;
            padding-bottom:40px;
        }
        .app-shell{
            max-width:1100px;
            margin:40px auto;
            padding:24px;
            border-radius:16px;
            background: linear-gradient(180deg, rgba(255,255,255,0.08), rgba(255,255,255,0.03));
            box-shadow: 0 6px 30px rgba(2,6,23,0.6);
            backdrop-filter: blur(8px);
            color:#e6eef8;
        }
        .header-row h2{font-weight:700; letter-spacing:-0.4px;}
        .glass-card{
            background: var(--glass-bg);
            color: #071023;
            padding:18px;
            border-radius:12px;
            box-shadow: 0 4px 18px rgba(2,6,23,0.25);
        }
        .controls .form-control{
            border-radius:10px;
            padding:12px 14px;
        }
        .btn-accent{
            background: linear-gradient(90deg,var(--accent), #5b8bff);
            color:#fff;
            border: none;
        }
        table.table{
            background: transparent;
            color: #071023;
        }
        thead.table-dark{
            background: linear-gradient(90deg, rgba(0,0,0,0.6), rgba(0,0,0,0.65));
            color:#fff;
        }
        .action-btns .btn{
            border-radius:8px;
            padding:6px 10px;
        }
        .muted-small{font-size:0.9rem; color: rgba(230,238,248,0.75);}
        @media (max-width:720px){
            .table-responsive{overflow:auto;}
            .header-row{flex-direction:column; gap:10px;}
        }
    </style>
</head>
<body>
<div class="container app-shell">
    <div class="d-flex justify-content-between align-items-center header-row mb-3">
        <div>
            <h2 class="mb-1">üì¶ Lista de Env√≠os</h2>
            <div class="muted-small">Administra tus env√≠os ‚Äî r√°pido y seguro</div>
        </div>
        <div class="d-flex gap-2">
            <a href="crear.php" class="btn btn-accent d-flex align-items-center gap-2"><i class="bi bi-plus-lg"></i> Nuevo Env√≠o</a>
        </div>
    </div>

    <div class="glass-card mb-3">
        <div class="row g-2 align-items-center">
            <div class="col-md-6 col-12">
                <div class="input-group controls">
                    <span class="input-group-text bg-transparent border-0"><i class="bi bi-search"></i></span>
                    <input id="search" class="form-control" placeholder="Buscar por destinatario, direcci√≥n o descripci√≥n...">
                </div>
            </div>
            <div class="col-md-6 col-12 text-md-end text-start">
                <span class="muted-small">Resultados: <strong id="count">‚Äî</strong></span>
            </div>
        </div>
    </div>

    <div class="table-responsive glass-card">
        <table class="table align-middle mb-0">
            <thead class="table-dark">
                <tr>
                    <th style="width:60px">ID</th>
                    <th>Destinatario</th>
                    <th>Direcci√≥n</th>
                    <th>Descripci√≥n</th>
                    <th style="width:180px">Acciones</th>
                </tr>
            </thead>
            <tbody id="envios-list">
            <?php
            $stmt = $conexion->query("SELECT * FROM envios ORDER BY id DESC");
            while ($row = $stmt->fetch(PDO::FETCH_ASSOC)): ?>
                <tr data-search="<?= htmlspecialchars($row['destinatario'] . ' ' . $row['direccion'] . ' ' . $row['descripcion']) ?>">
                    <td><?= $row['id'] ?></td>
                    <td><?= htmlspecialchars($row['destinatario']) ?></td>
                    <td><?= htmlspecialchars($row['direccion']) ?></td>
                    <td><?= htmlspecialchars($row['descripcion']) ?></td>
                    <td class="action-btns">
                        <a href="editar.php?id=<?= $row['id'] ?>" class="btn btn-warning btn-sm"><i class="bi bi-pencil"></i> Editar</a>
                        <a href="eliminar.php?id=<?= $row['id'] ?>" class="btn btn-danger btn-sm btn-delete"><i class="bi bi-trash"></i> Eliminar</a>
                    </td>
                </tr>
            <?php endwhile; ?>
            </tbody>
        </table>
    </div>
</div>

<script>
    // Filtrado simple en cliente y contador
    (function(){
        const input = document.getElementById('search');
        const tbody = document.getElementById('envios-list');
        const rows = Array.from(tbody.querySelectorAll('tr'));
        const countEl = document.getElementById('count');

        function updateCount() {
            const visible = rows.filter(r => r.style.display !== 'none').length;
            countEl.textContent = visible;
        }

        function filter(q){
            q = q.trim().toLowerCase();
            rows.forEach(r=>{
                const text = (r.dataset.search || '').toLowerCase();
                r.style.display = q === '' ? '' : (text.includes(q) ? '' : 'none');
            });
            updateCount();
        }

        input.addEventListener('input', ()=> filter(input.value));
        // init count
        updateCount();

        // Confirmaci√≥n para eliminar (por seguridad, override de onclick original)
        document.addEventListener('click', function(e){
            const el = e.target.closest('.btn-delete');
            if(!el) return;
            const ok = confirm('¬øSeguro que deseas eliminar este env√≠o? Esta acci√≥n no se puede deshacer.');
            if(!ok) e.preventDefault();
        });
    })();
</script>
</body>
</html>
